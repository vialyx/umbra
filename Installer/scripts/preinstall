#!/bin/bash

# Pre-installation script for Umbra
# Stops running instance if exists

CURRENT_USER=$(stat -f "%Su" /dev/console)
USER_HOME=$(eval echo ~$CURRENT_USER)
PLIST_PATH="$USER_HOME/Library/LaunchAgents/com.umbra.app.plist"

echo "Preparing for Umbra installation..."

# Stop running instance
if [ -f "$PLIST_PATH" ]; then
    echo "Stopping existing Umbra instance..."
    sudo -u "$CURRENT_USER" launchctl unload "$PLIST_PATH" 2>/dev/null || true
fi

# Kill any running instances
killall Umbra 2>/dev/null || true

echo "Ready for installation"

exit 0
